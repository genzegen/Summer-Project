{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BYR3D | Get Started</title>
    <link rel="stylesheet" href="{% static 'css/getStarted.css' %}">
    <script type="module" src="/static/js/three.js-master/build/three.module.js?v=1.0"></script>
        <style>
            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
                height: 100vh;
                background-image: radial-gradient(circle, #381d15, #6b4234, #14283a, #1a1129);
                background-size: cover;
            }

            #particleCanvas {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: -1;
                pointer-events: none;
            }
        </style>
    </head>
    <body>
        <canvas id="particleCanvas"></canvas>

        <div class="container">
            <div class="main">
                <div class="for-image">
                    <img src="{% static 'images/getstarted.jpg' %}" style="border-radius: 5%; width: 90%; height: auto; align-self: center;">
                    <img src="{% static 'images/logo.png' %}" style="width: 40%; height: auto; align-self: center;">
                </div>
                <div class="login-register">
                    <!-- Login Form -->
                    <form id="loginForm" method="POST" action="{% url 'getStarted' %}">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="login">
                        <input type="text" name="username" placeholder="Username" required>
                        <input type="password" name="password" placeholder="Password" required>
                        <button type="submit">Login</button>
                    </form>

                    <!-- Register Form (Hidden by Default) -->
                    <form id="registerForm" method="POST" action="{% url 'getStarted' %}" style="display: none;">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="register">
                        <input type="text" name="username" placeholder="Username" required>
                        <input type="email" name="email" placeholder="Email" required>
                        <input type="password" name="password1" placeholder="Password" required>
                        <input type="password" name="password2" placeholder="Confirm Password" required>
                        <button type="submit">Register</button>
                    </form>

                    <!-- Switch between Login and Register -->
                    <p class="switch-text">
                        <span id="toggleFormText">Don't have an account?</span>
                        <a id="toggleFormLink" onclick="toggleForms()">Register here</a>
                        {% if messages %}
                            <div class="messages">
                                    {% for message in messages %}
                                        <p class+"message">{{ message }}</p>
                                    {% endfor %}
                            </div>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <script type="module" src="{% static 'js/home.js' %}"></script>
        <script src="{% static 'js/getStarted.js' %}"></script>
        <script>
            document.getElementById("registerForm").addEventListener("submit", function (e) {
                const email = this.email.value;
                const password1 = this.password1.value;
                const password2 = this.password2.value;

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*?&]{8,}$/;

                if (!emailRegex.test(email)) {
                    alert("Please enter a valid email.");
                    e.preventDefault();
                    return;
                }

                if (password1 !== password2) {
                    alert("Passwords do not match.");
                    e.preventDefault();
                    return;
                }

                if (!passwordRegex.test(password1)) {
                    alert("Password must be at least 8 characters and contain both letters and numbers.");
                    e.preventDefault();
                }
            });
        </script>
        <script>
            // Particle effect script
            const canvas = document.getElementById('particleCanvas');
            const ctx = canvas.getContext('2d');
            let particles = [];

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            class Particle {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.size = Math.random() * 5 + 1;
                    this.speedX = Math.random() * 3 - 1.5;
                    this.speedY = Math.random() * 3 - 1.5;
                }

                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;

                    if (this.size > 0.2) this.size -= 0.1;
                }

                draw() {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            function init() {
                particles = [];
                for (let i = 0; i < 100; i++) {
                    particles.push(new Particle(Math.random() * canvas.width, Math.random() * canvas.height));
                }
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(particle => {
                    particle.update();
                    particle.draw();
                });
                requestAnimationFrame(animate);
            }

            init();
            animate();

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                init();
            });
        </script>

    </body>
    </html>
