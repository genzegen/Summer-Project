{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community</title>
    <link rel="stylesheet" href="{% static 'css/community.css' %}">
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
</head>
<body>
    <canvas id="particleCanvas"></canvas>
    <div class="public-posts-container">
        <div class="navbar">
            <div class="left">
                <a href="{% url 'mainpage' %}">
                    <img src="{% static 'images/logo.png' %}" style="height: 10vh; width: auto" />
                </a>
                <a href="{% url 'community' %}">Discover Ideas</a>
                <a href="{% url 'contact' %}">Contact Us</a>
                <a href="{% url "help" %}">Help Center</a>
            </div>
            <div class="right">
                {% comment %} profile section {% endcomment %}
                <button class="nav-button" id="profile-img">
                    {% if profile.profile_picture %}
                        <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" />
                    {% else %}
                        <img src="{% static 'images/default-profile.jpg' %}" alt="Default Profile Picture" />
                    {% endif %}
                </button>
                {% if user.is_authenticated %}
                <div class="popup" id="profile">
                    <div class="pop-content">
                        <div id="profile-pop-content">
                            <button id="close-profile">&#10006;</button>
                            <div class="profile-img">
                                {% if profile.profile_picture %}
                                    <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" />
                                {% else %}
                                    <img src="{% static 'images/default-profile.jpg' %}" alt="Default Profile Picture" />
                                {% endif %}
                            </div>
                            <div class="profile-details">
                                <p style="font-size: 1.5rem;">{{ user.username }}</p>
                                <p id="about-user">{{ profile.bio }}</p>
                                <form method="POST" action="{% url 'getStarted' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="form_type" value="logout">
                                    <button id="logout-btn" class="button" style="width: 14vw; margin-top: 5vh; bottom: 2vh;">Log Out</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

            </div>
        </div>

        <div class="content">
            {% if posts %}
                <div class="posts-grid">
                    {% for post in posts %}
                        <div class="post-card">
                            <!-- Screenshot Section -->
                            <div class="thumbnail">
                                {% if post.room_design.screenshot %}
                                    <img src="{{ post.room_design.screenshot.url }}" 
                                         alt="{{ post.room_design.title }}" 
                                         class="room-thumbnail">
                                {% else %}
                                    <div class="no-thumbnail">
                                        <p>No preview available</p>
                                    </div>
                                {% endif %}
                            </div>
    
                            <!-- Project Details -->
                            <div class="post-details">
                                <h3>{{ post.room_design.title }}</h3>
                                <p class="author">By {{ post.user.username }}</p>
                                <p class="description">{{ post.description }}</p>
                                <p class="date">Posted on {{ post.created_at|date:"F j, Y" }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="no-posts">No public projects yet. Be the first to post!</p>
            {% endif %}
            </div>
    </div>
    <script src="{% static 'js/three.js-master/build/three.module.js' %}"></script>
    <script src="{% static 'js/three.js-master/examples/jsm/controls/OrbitControls.js' %}"></script>
    <script src="{% static 'js/three.js-master/examples/jsm/loaders/GLTFLoader.js' %}"></script>

    <script type="module" src="{% static 'js/home.js' %}"></script>
    <script type="module" src="{% static 'js/profile.js' %}"></script>
    <script>
        function initRoomPreview(canvasElement, roomData) {
            // Scene setup
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x040c24);
            
            // Camera setup
            const camera = new THREE.PerspectiveCamera(75, 
                canvasElement.clientWidth / canvasElement.clientHeight, 
                0.1, 
                1000
            );
            camera.position.set(0, 30, 60);
            camera.lookAt(0, 12, 0);

            // Renderer setup
            const renderer = new THREE.WebGLRenderer({ 
                canvas: canvasElement,
                antialias: true
            });
            renderer.setSize(canvasElement.clientWidth, canvasElement.clientHeight);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 3);
            directionalLight.position.set(0, 17, -40);
            scene.add(directionalLight);

            // Floor
            const floorGeometry = new THREE.PlaneGeometry(
                roomData.length * 2, 
                roomData.breadth * 2
            );
            const floorMaterial = new THREE.MeshPhongMaterial({
                color: new THREE.Color(roomData.floor_color),
                side: THREE.DoubleSide
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = Math.PI / 2;
            floor.position.y = 0.5;
            scene.add(floor);

            // Walls (implementation from your create page)
            const wallMaterial = new THREE.MeshBasicMaterial({ 
                color: new THREE.Color(roomData.wall_color)
            });
            // Add your wall creation logic here

            // Grid
            const gridHelper = new THREE.GridHelper(100, 100);
            gridHelper.position.y = 0.5;
            scene.add(gridHelper);

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }
            animate();
        }
    </script>

</body>
</html>